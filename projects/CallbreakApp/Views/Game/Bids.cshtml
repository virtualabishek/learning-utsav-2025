@model Dictionary<int, int>
@{
    ViewData["Title"] = $"Bids - Round {ViewBag.Round}";
    var session = ViewBag.Session as GameSession;
    var prefill = Model ?? new Dictionary<int, int>();
}
<div class="container-fluid">
    <h2>Bids for Round @ViewBag.Round</h2>
    @if (TempData["Info"] != null) { <div class="alert alert-info">@TempData["Info"]</div> }
    <form asp-action="Bids" method="post">
        <input type="hidden" name="round" value="@ViewBag.Round" />
        <table class="table table-striped table-responsive">
            <thead>
                <tr>
                    <th>Player</th>
                    <th class="text-end">Current Score</th>
                        <th>Bid (0-13)</th>
                        <th class="text-end">Projected Round</th>
                        <th class="text-end">Projected Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var player in session?.Players ?? Enumerable.Empty<CallbreakApp.Models.PlayerSession>())
                {
                    <tr>
                        <td>@player.Name</td>
                        <td class="text-end">@player.TotalScore</td>
                        <td>
                            <input type="number" name="bids[@player.Id]" min="0" max="13" class="form-control d-inline w-auto" value="@(prefill.ContainsKey(player.Id) ? prefill[player.Id].ToString() : String.Empty)" required />
                        </td>
                            <td class="text-end">@((ViewBag.ProjectedRound != null && ((Dictionary<int,double>)ViewBag.ProjectedRound).ContainsKey(player.Id)) ? ((Dictionary<int,double>)ViewBag.ProjectedRound)[player.Id].ToString("0.0") : "-")</td>
                            <td class="text-end">@((ViewBag.ProjectedTotals != null && ((Dictionary<int,double>)ViewBag.ProjectedTotals).ContainsKey(player.Id)) ? ((Dictionary<int,double>)ViewBag.ProjectedTotals)[player.Id].ToString("0.0") : "-")</td>
                    </tr>
                }
            </tbody>
            <tfoot>
                <tr>
                    <th>Totals</th>
                        <th class="text-end">@((session?.Players.Sum(p => p.TotalScore)) ?? 0)</th>
                        <th></th>
                        <th class="text-end">@((ViewBag.ProjectedRound != null) ? ((Dictionary<int,double>)ViewBag.ProjectedRound).Values.Sum().ToString("0.0") : "-")</th>
                        <th class="text-end">@((ViewBag.ProjectedTotals != null) ? ((Dictionary<int,double>)ViewBag.ProjectedTotals).Values.Sum().ToString("0.0") : "-")</th>
                </tr>
            </tfoot>
        </table>
        <button type="submit" class="btn btn-success">Save Bids</button>
    </form>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        $('input[type=number]').on('input', function() {
            if ($(this).val() > 13) $(this).val(13);
        }); 
    });
</script>